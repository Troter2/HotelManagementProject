{% extends "base.html" %}
{% load static %}
{% block title %} Turnos {% endblock %}
{% block content %}

<!-- Modal -->
<div class="modal fade" id="dateModal" tabindex="-1" role="dialog" aria-labelledby="dateModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="dateModalLabel">Test</h5>
                <button type="button" id="close-modal-button" class="close" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h2>La vida</h2>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="close-modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center mt-4">
        <div class="col-md-8">
            <h1 class="mb-4">Mis turnos</h1>
            <div class="d-flex justify-content-between mb-3">
                <button class="btn btn-outline-secondary" id="prev-month">Mes Anterior</button>
                <h2 id="current-month">Marzo 2024</h2>
                <button class="btn btn-outline-secondary" id="next-month">Mes Siguiente</button>
            </div>
            <table class="table table-light">
                <thead>
                <tr>
                    <th>Lun</th>
                    <th>Mar</th>
                    <th>Mié</th>
                    <th>Jue</th>
                    <th>Vie</th>
                    <th>Sáb</th>
                    <th>Dom</th>
                </tr>
                </thead>
                <tbody id="calendar-body">
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Script para activar manualmente el modal sin jQuery -->
<script>
    var currentYear = 2024;
    var currentMonth = 2; // Marzo (los meses empiezan desde 0 en JavaScript)

    function generateCalendar(year, month) {
        var daysInMonth = new Date(year, month + 1, 0).getDate();
        var firstDayOfMonth = new Date(year, month, 1).getDay();

        // Ajustar el primer día para empezar en lunes
        if (firstDayOfMonth === 0) {
            firstDayOfMonth = 6;
        } else {
            firstDayOfMonth--;
        }

        var tbody = document.getElementById('calendar-body');
        tbody.innerHTML = '';

        var date = 1;
        for (var i = 0; i < 6; i++) {
            var row = document.createElement('tr');
            for (var j = 0; j < 7; j++) {
                var cell = document.createElement('td');
                if (i === 0 && j < firstDayOfMonth) {
                    cell.textContent = '';
                } else if (date > daysInMonth) {
                    break;
                } else {
                    var button = document.createElement('button');
                    button.textContent = date;
                    button.classList.add('btn', 'btn-outline-primary', 'btn-sm', 'btn-block', 'calendar-button');
                    button.style.border = '1px solid white';
                    cell.appendChild(button);
                    date++;
                }
                row.appendChild(cell);
            }
            tbody.appendChild(row);
        }
    }

    function updateMonth() {
        var monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
            'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        document.getElementById('current-month').textContent = monthNames[currentMonth] + ' ' + currentYear;
        generateCalendar(currentYear, currentMonth);
    }

    generateCalendar(currentYear, currentMonth); // Generar el calendario inicial

    document.getElementById('prev-month').addEventListener('click', function () {
        if (currentMonth === 0) {
            currentYear--;
            currentMonth = 11; // Diciembre
        } else {
            currentMonth--;
        }
        updateMonth();
    });

    document.getElementById('next-month').addEventListener('click', function () {
        if (currentMonth === 11) {
            currentYear++;
            currentMonth = 0; // Enero
        } else {
            currentMonth++;
        }
        updateMonth();
    });

    // Añade un evento de clic a cada botón del calendario
    document.querySelectorAll('.calendar-button').forEach(button => {
        button.addEventListener('click', function() {
            // Muestra el modal cuando se hace clic en el botón
            document.getElementById('dateModal').classList.add('show');
            document.getElementById('dateModal').style.display = 'block';
            document.body.classList.add('modal-open');
        });
    });

    // Añade un evento de clic al botón de cerrar modal
    document.getElementById('close-modal-button').addEventListener('click', function() {
        // Oculta el modal cuando se hace clic en el botón de cerrar
        document.getElementById('dateModal').classList.remove('show');
        document.getElementById('dateModal').style.display = 'none';
        document.body.classList.remove('modal-open');
    });
</script>

{% endblock %}
